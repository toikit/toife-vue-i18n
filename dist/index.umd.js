(function(i,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],c):(i=typeof globalThis<"u"?globalThis:i||self,c(i.ToifeVueI18n={},i.Vue))})(this,function(i,c){"use strict";let d=c.ref([]),p="";const s=c.ref({}),f=c.ref([]),a=c.ref(""),h="i18nDB",l="locales";function w(){return new Promise((e,t)=>{const o=indexedDB.open(h,1);o.onupgradeneeded=()=>{const n=o.result;n.objectStoreNames.contains(l)||n.createObjectStore(l)},o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async function j(e,t){const o=await w();return new Promise((n,r)=>{const u=o.transaction(l,"readwrite");u.objectStore(l).put(t,e),u.oncomplete=()=>n(),u.onerror=()=>r(u.error)})}async function g(e){const t=await w();return new Promise((o,n)=>{const u=t.transaction(l,"readonly").objectStore(l).get(e);u.onsuccess=()=>o(u.result),u.onerror=()=>n(u.error)})}function m(e){Array.isArray(e)?e.forEach(t=>{d.value.push(t)}):d.value.push(e),b(a.value)}function v(e={},t={}){for(const o of Object.keys(t)){const n=t[o],r=e[o];n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Function)?e[o]=v(r&&typeof r=="object"?r:{},n):e[o]=n}return e}function y(e,t){if(!e)return;const o=t.split(".");let n=e;for(const r of o){if(n==null)return;n=n[r]}return n}function _(e,t={}){return String(e).replace(/\{(\w+)\}/g,(o,n)=>t[n]===void 0?`{${n}}`:String(t[n]))}async function S(e,t,o){try{if(f.value.includes(t))return;const n=await import(o+"?t="+Date.now()),r=n.default??n;if(typeof r!="object"||r===null)throw new Error(`Locale module ${e} did not export an object`);s.value[e]=s.value[e]||{},s.value[e][t]=v(s.value[e]?.[t]||{},r),f.value.push(t),await j("__data_locale_"+t,r)}catch{const r=await g("__data_locale_"+t);r&&(s.value[e][t]=v(s.value[e]?.[t]||{},r),f.value.push(t))}}async function b(e){for(let t of d.value){const o=t.template.replace("{locale}",encodeURIComponent(e));S(e,t.name,o)}}async function T(e){a.value=e,await b(e)}function D(e){p=e}function L(){return a.value}function x(e){return function(t,o={}){const n=s.value[a.value]?.[e]||{};let r=y(n,t);if(r===void 0&&a.value!==p){const u=s.value[p]?.[e]||{};r=y(u,t)}if(r===void 0)return _(t,o);if(typeof r=="function")try{return r(o)}catch(u){return console.warn("i18n function error for key",t,u),""}return _(r,o)}}function A(){return{locale:a,isLocaleLoaded:e=>f.value.includes(e),setFallbackLocale:D,setLocale:T,addLocaleModule:m,getLocale:L}}c.watch(()=>a.value,async(e,t)=>{t!==void 0&&await b(e)},{immediate:!0}),i.useI18n=A,i.useTranslator=x,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
